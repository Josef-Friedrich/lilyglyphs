\NeedsTeXFormat{LaTeX2e} 
\ProvidesPackage{lilyglyphs}

% Enable the creation of starred commands
\RequirePackage{suffix}

% Access OpenTypeFonts
\RequirePackage{fontspec}

% Introduce key=value options
\RequirePackage{keyval}

% Define keys for keyval options
\makeatletter
% To be used by the generic access commands,
% values are used literally, scale as a factor,
% raise as a value in ex.
\define@key{lilyglyph}{scale}{\def\lily@scale{#1}}
\define@key{lilyglyph}{raise}{\def\lily@raise{#1}}
% To be used by high-level music commands,
% values are to be calculated against the defaults.
% scale will be added,
% raise multiplied with the default value
\define@key{lilyCmd}{scale}{\def\lilyCmd@scale{#1}}
\define@key{lilyCmd}{raise}{\def\lilyCmd@raise{#1}}

\newcommand{\calclilykeys}[1]{%
    % set the temporary keys from the options argument
	\setkeys{lilyCmd}{#1}%
%\lilyCmd@scale	
	\newcount\effectiveScale{\lilyCmd@scale}

	Scale = \multiply\effectiveScale by 3

%	\multiply\effectiveScale by \lilyCmd@Scale
	\setkeys{lilyglyph}{{scale=\effectiveScale},raise=1}
%	\lilyCmd@scale
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Generic command(s) to select a LilyPond Glyph %
%
% Determine the glyph by its OpenType glyphName

\newcommand*{\lilyGlyph}[2][]{%
	% set design defaults for any glyph
	\setkeys{lilyglyph}{scale=1,raise=0}%
	% initialize arguments (no argument = no change)
	\setkeys{lilyCmd}{scale=1,raise=0}
	% interpret actual arguments
	\calclilykeys{#1}%
	\raisebox{{\lily@raise}ex}{%
	{\fontspec[Scale=\lily@scale]{Emmentaler-16}\XeTeXglyph\XeTeXglyphindex"#2" }%
	}%
}

% Determine the glyph by its Unicode number 
% (works for those glyphs that reside in 'standard' places)
\newcommand*{\lilyGlyphByNumber}[2][]{%
	% set defaults
	\setkeys{lilyglyph}{scale=1,raise=0}%
	% interpret actual arguments
	\setkeys{lilyglyph}{#1}%
	\raisebox{{\lily@raise}ex}{%
	{\fontspec[Scale=\lily@scale]{Emmentaler-16}\char"#2 }%
	}
}

% Don't 'determine' glyph positions but just use plain text.
% This works for dynamics letters, numbers and + - . ,
\newcommand*{\lilyText}[2][]{%
	% set defaults
	\setkeys{lilyglyph}{scale=1,raise=0}%
	% interpret actual arguments
	\setkeys{lilyglyph}{#1}%
	\raisebox{{\lily@raise}ex}{%
	{\fontspec[Scale=\lily@scale]{Emmentaler-16}#2}%
	}%
}

\makeatother


%%%%%%%%%%%%%%%
% Misc. tools %

% Dot, e.g. used to create dotted notes
\newcommand*{\lilyDot}{\lilyGlyph[scale=1.5]{"dots.dot"}}

\input{definitions/clefs.inp}

%\input{definitions/numbers.inp}

%\input{definitions/timesignatures.inp}

%\input{definitions/dynamics.inp}

%\input{definitions/accidentals.inp}

%\input{definitions/noteheads.inp}

%%%%%%%%%%%
% Numbers %
%%%%%%%%%%%

%\newcommand*{\lilyNumber}[1]{\lilyGlyphByNumber{1.1}{3#1}}
%\WithSuffix\newcommand\lilyNumber*[1]{\lilyNumber{#1} }




